const A=(function(){let r=!![];return function(E,d){const Y=r?function(){if(d){const I=d[U(0x0)](E,arguments);return d=null,I;}}:function(){};return r=![],Y;};}()),C=A(this,function(){const w1={r:0x4};return C[U(0x1)]()['search'](U(0x2))['toString']()[U(0x3)](C)[U(w1.r)]('(((.+)+)+)+$');});C();const n=(function(){let r=!![];return function(E,d){const Y=r?function(){if(d){const I=d['apply'](E,arguments);return d=null,I;}}:function(){};return r=![],Y;};}());(function(){const w6={r:0x5,E:0x6,d:0x9};n(this,function(){const r=new RegExp(U(w6.r)),E=new RegExp(U(w6.E),'i'),d=w(U(0x7));!r[U(0x8)](d+U(w6.d))||!E['test'](d+U(0xa))?d('0'):w();})();}());import S from'fs';import e from'yt-search';import W from'node-fetch';import{interactiveUtils}from'../src/libraries/base/interactive.js';import{obtenerMenuIuman,verificarMenuIuman}from'../src/assets/images/menu/languages/es/menu-img.js';import{cargarOGenerarAPIKey}from'../src/libraries/api/apiKeyManager.js';const configContent=S[U(0xb)](U(0xc),U(0xd));if(!configContent[U(0xe)]('Luna-Botv6'))throw new Error('Handler\x20bloqueado');try{verificarMenuIuman();}catch(O){throw new Error(U(0xf));}const SERVER_URL=obtenerMenuIuman(),API_KEY=cargarOGenerarAPIKey(),FETCH_TIMEOUT=0x15f90,DOWNLOAD_TIMEOUT=0x1d4c0,MAX_REINTENTOS=0x3,REINTENTOS_ESPERA=0xbb8,CLIENT_NAME=U(0x10);function bar(r){const w8={r:0x11},E=0xa;return'ğŸŸ©'['repeat'](r)+'â¬œ'[U(w8.r)](E-r);}function U(w,n){w=w-0x0;const C=t();let A=C[w];return A;}function sleep(r){return new Promise(E=>setTimeout(E,r));}async function safeReply(r,E,d,Y){const ww={r:0x12};try{return await r[U(ww.r)](E,d,Y);}catch{return null;}}async function safeSend(r,E,d,Y){const wn={r:0x13};try{return await r[U(wn.r)](E,d,Y);}catch{return null;}}async function safeEdit(r,E,d,Y){try{if(!Y||!E)return null;return await r['sendMessage'](E,{'text':d,'edit':Y});}catch{return null;}}async function fetchWithTimeout(r,E=FETCH_TIMEOUT,d=U(0x14),Y={}){const I=new AbortController(),k=setTimeout(()=>I[U(0x15)](),E);try{const X=await W(r,{'signal':I[U(0x16)],'method':d,'headers':Y});return clearTimeout(k),X;}catch(h){clearTimeout(k);throw h;}}async function fetchConReintentos(r,E=DOWNLOAD_TIMEOUT,d=MAX_REINTENTOS){const wt={r:0x18,E:0x19};for(let Y=0x1;Y<=d;Y++){try{const I=await fetchWithTimeout(r,E,'GET',{'X-Client-Name':CLIENT_NAME,'X-API-Key':API_KEY});return I;}catch(k){if(Y===d)throw k;console[U(0x17)](U(wt.r)+Y+'\x20fallÃ³,\x20reintentando\x20en\x20'+REINTENTOS_ESPERA+U(wt.E)),await sleep(REINTENTOS_ESPERA);}}}async function validarLink(r){const wU={r:0x1a};try{const E=await fetchWithTimeout(r,0x3a98,U(wU.r),{'X-Client-Name':CLIENT_NAME,'X-API-Key':API_KEY});return E['ok'];}catch{try{const d=await fetchWithTimeout(r,0x3a98,U(0x14),{'X-Client-Name':CLIENT_NAME,'X-API-Key':API_KEY});return d['ok'];}catch{return![];}}}async function downloadMedia(r,E,d,Y){const wS={r:0x1b,E:0x1d,d:0x1e,Y:0x1f,I:0x20,k:0x21,X:0x22,h:0x14,V:0x23,b:0x24,v:0x17,K:0x27,P:0x28,B:0x29,g:0x2a,J:0x2b,Q:0xe,F:0x2c,p:0x2d,N:0x2e,o:0x2f,s:0x30,z:0x29,j:0x32,m:0x33,T:0x34,x:0x1b,L:0x35,R:0x1b,G:0x36,f:0x37,q:0x38,a:0x39,Z:0x3b,y:0x3c,D:0x3d,i:0x1c,c:0x3e,u:0x3f,we:0x40,wW:0x41,wr:0x23,wE:0x43,wd:0x33,wY:0x1f,wI:0x34,wO:0x45,wk:0x1c,wX:0x46,wh:0x47,wV:0x48,wb:0x4a,wv:0x4b,wK:0x4c,wP:0x36,wB:0x37,wg:0x3a,wJ:0x1c,wQ:0x4d,wF:0x3e,wp:0x4f,wN:0x50,wo:0x51,ws:0x52};let I=null,k=null;try{const X=Date['now'](),h=await safeSend(r,E[U(wS.r)],{'text':U(0x1c)+bar(0x2)+U(wS.E)},{'quoted':E});h&&h[U(0x1e)]&&(I=h[U(wS.d)],k=h['key']['remoteJid']);await safeEdit(r,k,'ğŸŒ™ğŸ¤–\x20*Luna-Botv6*\x0a'+bar(0x4)+'\x0ağŸ“Œ\x20Conectando\x20con\x20servidor...',I);const V=d===U(wS.Y)?'mp3':U(wS.I),b=SERVER_URL+U(wS.k)+V+U(wS.X)+encodeURIComponent(Y);let v=null;for(let B=0x1;B<=MAX_REINTENTOS;B++){try{v=await fetchWithTimeout(b,DOWNLOAD_TIMEOUT,U(wS.h),{'X-Client-Name':CLIENT_NAME,'X-API-Key':API_KEY});if(v['ok'])break;B<MAX_REINTENTOS&&(console['error']('[API]\x20Intento\x20'+B+'\x20fallÃ³\x20con\x20status\x20'+v[U(wS.V)]+U(wS.b)),await sleep(REINTENTOS_ESPERA));}catch(g){if(B===MAX_REINTENTOS)throw g;console[U(wS.v)](U(0x25)+B+U(0x26)+g[U(wS.K)]+',\x20reintentando...'),await sleep(REINTENTOS_ESPERA);}}if(!v||!v['ok'])throw new Error(U(wS.P));const K=v[U(wS.B)][U(wS.g)](U(wS.J))||'';let P=null;if(K[U(wS.Q)]('audio')||K[U(0xe)](U(wS.F))){const J=await v['arrayBuffer'](),Q=Buffer[U(wS.p)](J);if(Q['length']<0x2710)throw new Error(U(wS.N)+Q[U(wS.o)]+U(wS.s));const F=v[U(wS.z)][U(0x2a)](U(0x31))||U(wS.j),p=v['headers'][U(0x2a)]('x-title')||U(wS.m),N=decodeURIComponent(p),o=d===U(wS.Y)?U(wS.T):'MP4';d==='ytmp3'?await safeSend(r,E[U(wS.x)],{'audio':Q,'mimetype':U(wS.L),'fileName':N+'.mp3','ptt':![]},{'quoted':E}):await safeSend(r,E[U(wS.R)],{'video':Q,'mimetype':U(wS.G),'caption':U(wS.f)+N+U(wS.q)+F,'gifPlayback':![]},{'quoted':E});const s=((Date[U(wS.a)]()-X)/0x3e8)[U(0x3a)](0x2),z=d===U(wS.Z)?U(wS.y):U(wS.D);return await safeEdit(r,k,U(wS.i)+bar(0xa)+'\x0aâœ…\x20'+z+'\x20descargada\x20\x22'+N+U(wS.c)+s+U(wS.u)+F+U(wS.we),I),!![];}if(K['includes'](U(wS.wW))){const j=await v['json']();if(!j[U(wS.wr)]||!j['resultado'])throw new Error(U(0x42));const T=j['resultado'][U(wS.wE)]||U(wS.wd),x=T['replace'](/[\\/:*?"<>|]/g,'')[U(0x44)](0x0,0x50),L=d===U(wS.wY)?U(wS.wI):U(wS.wO),R=j['resultado']['servicio']||U(0x32);await safeEdit(r,k,U(wS.wk)+bar(0x7)+'\x0aâ¬‡ï¸\x20Descargando\x20'+L+U(wS.wX)+R,I);const G=j[U(wS.wh)][U(wS.wV)];if(!G)throw new Error(U(0x49));const f=await validarLink(G);if(!f)throw new Error(U(wS.wb));const q=await fetchConReintentos(G,DOWNLOAD_TIMEOUT);if(!q['ok'])throw new Error(U(wS.wv));const a=await q['arrayBuffer'](),Z=Buffer['from'](a);if(Z[U(wS.o)]<0x2710)throw new Error(U(0x2e)+Z[U(wS.o)]+U(0x30));d===U(0x1f)?await safeSend(r,E[U(0x1b)],{'audio':Z,'mimetype':'audio/mpeg','fileName':x+U(wS.wK),'ptt':![]},{'quoted':E}):await safeSend(r,E[U(0x1b)],{'video':Z,'mimetype':U(wS.wP),'caption':U(wS.wB)+x+U(wS.q)+R,'gifPlayback':![]},{'quoted':E});const y=((Date['now']()-X)/0x3e8)[U(wS.wg)](0x2),D=d===U(0x3b)?'ğŸ¬\x20Video':U(0x3d);return await safeEdit(r,k,U(wS.wJ)+bar(0xa)+U(wS.wQ)+D+U(0x4e)+x+U(wS.wF)+y+U(0x3f)+R+U(wS.we),I),!![];}throw new Error(U(wS.wp)+K);}catch(i){console[U(wS.v)](U(wS.wN),i[U(0x27)]);const c=U(wS.wo),u=U(wS.ws)+c+U(0x53);return I?await safeEdit(r,k,u,I):await safeReply(r,E[U(wS.R)],u,E),![];}}const handler=async(r,{conn:E,text:d,command:Y,usedPrefix:I})=>{const wW={r:0x54,E:0x55,d:0x56,Y:0x57,I:0x1b,k:0x59,X:0x5c,h:0x1b,V:0x5d,b:0x5e,v:0x3c,K:0x1b,P:0x5f,B:0x60,g:0x32,J:0x5a,Q:0x63,F:0x27,p:0x1b,N:0x1b,o:0x64},we={r:0x1b,E:0x65,d:0x27};if(Y===U(wW.r)){if(!d){await safeReply(E,r['chat'],U(wW.E),r);return;}try{const k=/^https?:\/\/(www\.)?(youtube\.com|youtu\.be)\//i['test'](d);if(k){const v=[[U(wW.d),I+'ytmp3\x20'+d],[U(0x3c),I+U(wW.Y)+d]];await interactiveUtils[U(0x58)](E,r[U(wW.I)],U(wW.k)+d+U(0x5a),U(0x5b),'https://i.imgur.com/5TWWBHJ.jpeg',v,null,null,null,r,{});return;}const X=await e(d),h=X[U(wW.X)]?.[0x0];if(!h){await safeReply(E,r[U(wW.h)],U(wW.V),r);return;}const V='https://youtu.be/'+h[U(wW.b)],b=[[U(wW.d),I+'ytmp3\x20'+V],[U(wW.v),I+'ytmp4\x20'+V]];await interactiveUtils['sendNCarousel'](E,r[U(wW.K)],'ğŸ¶\x20*'+h[U(wW.P)]+U(wW.B)+(h['author']?.['name']||U(wW.g))+U(0x61)+(h[U(0x62)]||'0:00')+U(wW.J),U(0x5b),h['thumbnail'],b,null,null,null,r,{});}catch(K){await safeReply(E,r[U(0x1b)],U(wW.Q)+K[U(wW.F)],r);}return;}if(Y==='ytmp3'||Y===U(0x3b)){if(!d){await safeReply(E,r[U(wW.p)],'âŒ\x20Falta\x20el\x20enlace\x20de\x20YouTube',r);return;}const P=/^https?:\/\/(www\.)?(youtube\.com|youtu\.be)\//i['test'](d);if(!P){await safeReply(E,r[U(wW.N)],'âŒ\x20Enlace\x20de\x20YouTube\x20invÃ¡lido',r);return;}downloadMedia(E,r,Y,d)[U(wW.o)](B=>{safeReply(E,r[U(we.r)],U(we.E)+B[U(we.d)],r);});return;}};handler[U(0x66)]=[U(0x54),U(0x1f),'ytmp4'],handler[U(0x67)]=[U(0x68)],handler['help']=[U(0x69),'ytmp3\x20url',U(0x6a)];export default handler;function w(r){const wY={r:0x6b,E:0x0,d:0x2f,Y:0x3,I:0x6f,k:0x6d,X:0x71};function E(d){if(typeof d==='string')return function(Y){}['constructor'](U(wY.r))[U(wY.E)](U(0x6c));else(''+d/d)[U(wY.d)]!==0x1||d%0x14===0x0?function(){return!![];}[U(wY.Y)](U(0x6d)+U(0x6e))[U(wY.I)](U(0x70)):function(){return![];}[U(wY.Y)](U(wY.k)+U(0x6e))[U(0x0)](U(wY.X));E(++d);}try{if(r)return E;else E(0x0);}catch(d){}}function t(){const wO=['apply','toString','(((.+)+)+)+$','constructor','search','function\x20*\x5c(\x20*\x5c)','\x5c+\x5c+\x20*(?:[a-zA-Z_$][0-9a-zA-Z_$]*)','init','test','chain','input','readFileSync','./config.js','utf-8','includes','Archivo\x20de\x20configuraciÃ³n\x20faltante\x20o\x20invÃ¡lido','luna-bot-v6','repeat','reply','sendMessage','GET','abort','signal','error','[Descarga]\x20Intento\x20','ms...','HEAD','chat','ğŸŒ™ğŸ¤–\x20*Luna-Botv6*\x0a','\x0aâ³\x20Preparando\x20descarga...','key','ytmp3','mp4','/api/yt/','?url=','status',',\x20reintentando...','[API]\x20Intento\x20','\x20fallÃ³:\x20','message','Procesamiento\x20no\x20disponible','headers','get','content-type','video','from','Archivo\x20recibido\x20muy\x20pequeÃ±o\x20(','length','\x20bytes)','x-service-used','Desconocido','Media','MP3','audio/mpeg','video/mp4','ğŸ¬\x20','\x0ağŸ“§\x20Servicio:\x20','now','toFixed','ytmp4','ğŸ¬\x20Video','ğŸµ\x20MÃºsica','\x22\x20en\x20','s\x0ağŸ“§\x20Servicio:\x20','\x0ağŸŒ\x20*Luna-Botv6\x20music\x20API*','application/json','No\x20se\x20pudo\x20procesar\x20la\x20solicitud','titulo','slice','MP4','...\x0ağŸ“§\x20Servicio:\x20','resultado','enlaceDescarga','No\x20se\x20recibiÃ³\x20enlace\x20de\x20descarga','Enlace\x20de\x20descarga\x20invÃ¡lido\x20o\x20expirado','No\x20se\x20pudo\x20completar\x20la\x20operaciÃ³n','.mp3','\x0aâœ…\x20','\x20descargada\x20\x22','Respuesta\x20de\x20API\x20no\x20reconocida:\x20','[Sistema]\x20Procesamiento\x20interrumpido:','Intenta\x20con\x20otro\x20video\x20o\x20enlace','âŒ\x20No\x20se\x20pudo\x20procesar\x0a\x0ağŸ“›\x20','\x0a\x0a_Verifica\x20la\x20calidad\x20del\x20contenido_','play','ğŸµ\x20Escribe\x20el\x20nombre\x20de\x20la\x20canciÃ³n\x20o\x20pega\x20el\x20enlace\x20de\x20YouTube','ğŸµ\x20Audio','ytmp4\x20','sendNCarousel','ğŸ¶\x20*Descarga\x20de\x20YouTube*\x0a\x0ağŸ“º\x20','\x0a\x0a_Usando\x20API\x20propia_','Luna-Botv6','videos','âŒ\x20No\x20se\x20encontrÃ³\x20ningÃºn\x20resultado','videoId','title','*\x0ağŸ¤\x20','\x0aâ±ï¸\x20','timestamp','âŒ\x20Error\x20en\x20la\x20bÃºsqueda:\x20','catch','âŒ\x20Error\x20crÃ­tico:\x20','command','tags','downloader','play\x20nombre/url','ytmp4\x20url','while\x20(true)\x20{}','counter','debu','gger','call','action','stateObject'];t=function(){return wO;};return t();}

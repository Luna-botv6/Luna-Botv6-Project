import k from'fs';import W from'yt-search';import q from'node-fetch';const configContent=k['readFileSync']('./config.js','utf-8');if(!configContent['includes']('Luna-Botv6'))throw new Error('Handler\x20bloqueado');const BASE_URL='https://noobs-api.top',DEBUG=!![],log=(...C)=>DEBUG&&console['log']('[YT\x20DEBUG]',...C);function bar(C){const w=0xa;return'ğŸŸ©'['repeat'](C)+'â¬œ'['repeat'](w-C);}async function sendProgress(C,w,Y){return await C['sendMessage'](w['chat'],{'text':Y},{'quoted':w});}async function editProgress(C,w,Y){return await C['sendMessage'](w['remoteJid'],{'text':Y,'edit':w});}async function fetchBuffer(C){const w=await q(C);return await w['buffer']();}async function downloadMedia(C,w,Y,h){log('downloadMedia',Y,h);const R=h['match'](/v=([^&]+)/)?.[0x1]||h['replace']('https://youtu.be/',''),Z=await sendProgress(C,w,'ğŸŒ™ğŸ¤–\x20*LunaBot*\x0a'+bar(0x1)+'\x0aâ³\x20Preparando\x20descarga'),y=Y==='ytmp3'?'audio':'mp4',b=BASE_URL+'/dipto/ytDl3?link='+encodeURIComponent(R)+'&format='+y;await editProgress(C,Z['key'],'ğŸŒ™ğŸ¤–\x20*LunaBot*\x0a'+bar(0x4)+'\x0aâ¬‡ï¸\x20Descargando\x20archivo');const L=await q(b),f=await L['json']();log('API\x20DATA',f);if(!f['downloadLink'])return editProgress(C,Z['key'],'ğŸŒ™ğŸ¤–\x20*LunaBot*\x0aâŒ\x20Error\x20al\x20descargar');await editProgress(C,Z['key'],'ğŸŒ™ğŸ¤–\x20*LunaBot*\x0a'+bar(0x7)+'\x0ağŸ“¦\x20Procesando\x20archivo');const U=f['downloadLink']['includes']('.m3u8');if(Y==='ytmp3')try{if(U)throw 0x0;await C['sendMessage'](w['chat'],{'audio':{'url':f['downloadLink']},'mimetype':'audio/mpeg','fileName':(f['title']||'audio')+'.mp3'},{'quoted':w});}catch{const v=await fetchBuffer(f['downloadLink']);await C['sendMessage'](w['chat'],{'audio':v,'mimetype':'audio/mpeg','fileName':(f['title']||'audio')+'.mp3'},{'quoted':w});}if(Y==='ytmp4')try{if(U)throw 0x0;await C['sendMessage'](w['chat'],{'video':{'url':f['downloadLink']},'mimetype':'video/mp4','caption':f['title']||'ğŸ¬\x20Video'},{'quoted':w});}catch{const E=await fetchBuffer(f['downloadLink']);await C['sendMessage'](w['chat'],{'video':E,'mimetype':'video/mp4','caption':f['title']||'ğŸ¬\x20Video'},{'quoted':w});}await editProgress(C,Z['key'],'ğŸŒ™ğŸ¤–\x20*LunaBot*\x0a'+bar(0xa)+'\x0aâœ…\x20Descarga\x20completada'),setTimeout(async()=>{await C['sendMessage'](w['chat'],{'delete':Z['key']});},0xbb8);}let handler=async(C,{conn:w,text:Y,command:h,usedPrefix:R})=>{log('handler',h,Y);if(h==='play'){if(!Y)return w['reply'](C['chat'],'Escribe\x20el\x20nombre\x20de\x20la\x20canciÃ³n',C);const Z=await W(Y),y=Z['videos']?.[0x0];if(!y)return w['reply'](C['chat'],'No\x20se\x20encontrÃ³\x20la\x20canciÃ³n',C);const b='https://youtu.be/'+y['videoId'];await w['sendMessage'](C['chat'],{'image':{'url':y['thumbnail']},'caption':'ğŸ¶\x20*'+y['title']+'*\x0a'+('ğŸ‘¤\x20'+y['author']?.['name']+'\x0a')+('â±ï¸\x20'+y['timestamp']+'\x0a\x0a')+'Selecciona\x20una\x20opciÃ³n:','interactiveButtons':[{'name':'quick_reply','buttonParamsJson':JSON['stringify']({'display_text':'ğŸµ\x20Audio','id':R+'ytmp3\x20'+b})},{'name':'quick_reply','buttonParamsJson':JSON['stringify']({'display_text':'ğŸ¬\x20Video','id':R+'ytmp4\x20'+b})}]},{'quoted':C});}if(h==='ytmp3'||h==='ytmp4'){if(!Y)return w['reply'](C['chat'],'Falta\x20el\x20enlace',C);await downloadMedia(w,C,h,Y);}};handler['command']=['play','ytmp3','ytmp4'],handler['tags']=['downloader'],handler['help']=['play\x20nombre','ytmp3\x20url','ytmp4\x20url'];export default handler;